---
title: 索引优化
comments: true
date: 2017-09-01 13:58:10
updated: 2017-09-01 13:58:10
categories: Database
tags:
- 索引
---

**说明：**数据库的索引优化。
<!-- more -->


* 数据库方面的技能要求，包括如下层面：
	* 基本概念和语句使用，包括：增删改查CRUD、存储过程、事务……
	* 设计表的经验，包括：引擎、字段、范式……关键是要结合实际需求。
	* 数据库优化的经验，包括：索引、缓存、读写分离、冗余……
	* 分布式数据库与集群。

## 索引概述
* mysql联合索引
	* 索引的特性是：索引有序、高度较低、存储列值，联合索引对多个列建立索引表，查询的时候先进行第一列关键字查找，然后进行第二列关键字查找，类推然后返回结果。优点在于如果多个列同时限定的记录比较少就能建立联合索引减少数据量，以及如果将信息与查找值在一起就可以避免再次回表读取数据。但是联合索引的缺点是插入删除时需要更新索引，而建索引会锁定整张表，如果联合索引的列数超过3就应该考虑重新设计表，如果需要大量更新可以先删除索引再重建索引以提高效率。
	* 数据库联合索引，如果a(1-100)，b(1-3)，c(1-1000)的范围该怎么建。
* 索引结构：索引用BTree B树数据结构。
* 索引优缺点
	* 优点：快速检索
	* 缺点：占用额外磁盘空间、插入新数据需要重新构建索引。

* 是否需要使用索引的场景：
	* 场景一，数据表规模不大，就几千行，即使不建索引，查询语句的返回时间也不长，这时建索引的意义就不大。当然，若就几千行，索引所占的空间也不多，所以这种情况下，顶多属于“性价比”不高。
	* 场景二，某个商品表里有几百万条商品信息，同时每天会在一个时间点，往其中更新大概十万条左右的商品信息，现在用where语句查询特定商品时（比如wherename=‘XXX’）速度很慢。为了提升查询效率可以建索引，但当每天更新数据时，又会重建索引，这是要耗费时间的。这时就需要综合考虑，甚至可以在更新前删除索引，更新后再重建。
	* 场景三，如果在数据表里ID值都不相同，索引能发挥出比较大的作用。相反，如果某个字段重复率很高，如性别字段，或者某个字段大多数值是空（null），那么不建议对该字段建索引。

* sql是否正确利用了索引：
	* `select * from 商品表`，**没有where语句，不会用到索引**。如果有 where name=‘Java书’，会使用索引。当然如果数据量不多，或者name没有太多区分度，那么为name建索引也不会有太多好处。
	* `select * from 商品表 where name like ‘Java%’`， 这个模糊查询会用到索引。但是where name like ‘%java’，不会走索引。用like进行模糊查询时，**如果第一个是模糊的匹配符，就不会走索引，但只要不出现在第一个位置，不论用了多少个%，也不论%的位置，那么都能用到索引**。
	* `select * from 成绩表 where 成绩>95`，使用大于号，不能用到索引。为了用到索引，可以改为：where成绩in(96,97,98,99,100)。**当数值型的字段遇到非等值操作符时，无法使用索引**。
	* `select * from 成绩表 where score +40 = 100`，**对索引字段进行了某种左值操作，无法用到索引。**可以改为where score = 60可以使用索引。
	* `select * from 商品表 where substr(name)=‘J’`，**对索引字段进行了函数操作，无法用到索引。**可以改成where name like ‘%J’，也可以对substr(name)建索引。



